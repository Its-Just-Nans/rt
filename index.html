<!DOCTYPE html>
<head>
    <title>R&T</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="./style.css" rel="stylesheet">
</head>
<body>
    <nav>
        <h1 id="titleNav"><a id="link" href="">Navigation</a></h1>
        <ul>
            <li><a href="codage-canal">Codage Canal</a></li>
            <li><a href="train">Codage Canal Train</a></li>
            <li><a href="sinus">Sinus</a></li>
            <li><a href="readme-note">Some Notes</a></li>
            <li><a href="readme-wifi">Wifi</a></li>
        </ul>
        
    </nav>
    <section id="contenuMain"></section>

<!---Script of main-->
<script src="//its-just-nans.github.io/js/useful.js"></script>
<script src="//its-just-nans.github.io/js/smollPopUp.js"></script>
<script>
    
globalScope = {};
let basePage;
setResponsive();
window.onresize = setResponsive;

function checkStyleOfNav(){
    let navBlock = document.getElementsByTagName('nav')[0];
    if(navBlock.getElementsByTagName('ul')[0].style.display == 'none'){
        navBlock.getElementsByTagName('ul')[0].style.display = 'block';
    }else{
        navBlock.getElementsByTagName('ul')[0].style.display = 'none';
    }
}
function setResponsive(){
    if(window.innerWidth <= 1050){
        let navBlock = document.getElementsByTagName('nav')[0];
        navBlock.getElementsByTagName('ul')[0].style.display = 'none';
        navBlock.addEventListener('click', checkStyleOfNav, false);
    }else{
        if(document.getElementsByTagName('nav')[0].getElementsByTagName('ul')[0].style.display == 'none'){
            document.getElementsByTagName('nav')[0].getElementsByTagName('ul')[0].style.display = 'block';
        }
        document.getElementsByTagName('nav')[0].removeEventListener('click', checkStyleOfNav, false);
    }
}


if(window.location.search == ""){
    if(window.location.href.match('index.html')){
        basePage = window.location.href.replace('index.html', 'search.html');
    }else{
        if(window.location.origin === 'https://its-just-nans.github.io'){
            basePage = window.location.origin + '/rt/' + 'search.html';
        }else{
            basePage = window.location.origin + '/' + 'search.html';
        }
    }
}else{
    //check if it's in local
    if(window.location.origin === 'https://its-just-nans.github.io'){
        basePage = window.location.origin + '/rt/files/';
    }else{
        basePage = window.location.origin + '/files/';
    }
    if(window.location.search.startsWith('?readme-')){
        basePage += window.location.search.replace('?readme-', '') + '.md';
        for(scriptLink of ['https://unpkg.com/showdown/dist/showdown.min.js', '//unpkg.com/@highlightjs/cdn-assets@10.4.1/highlight.min.js']){
            let script = document.createElement('script');
            script.src = scriptLink;
            document.head.appendChild(script);
        }
        for(styleLink of ['../styleREADME.css', '//unpkg.com/@highlightjs/cdn-assets@10.4.1/styles/default.min.css']){
            let style = document.createElement('link');
            style.href = styleLink;
            style.rel = 'stylesheet';
            document.head.appendChild(style);
        }
    }else{
        basePage += window.location.search.replace('?', '') + '.html';
    }
}
loadNewPage(basePage);

function loadNewPage(url){
    makeRequest('GET', url).then( function(response){
        if(window.location.search.startsWith('?readme-')){
            //if it's a readme we need to render it
            document.getElementById('contenuMain').innerHTML = '<div id="globalReadMe" style="font-size: 1.15em;"></div>';
            let render = function(){
                if(typeof showdown !== 'undefined'){
                    let converter = new showdown.Converter();
                    converter.setFlavor('github');
                    let html = converter.makeHtml(response);
                    document.getElementById('globalReadMe').innerHTML = html;
                    document.querySelectorAll('pre code').forEach((block) => {
                        hljs.highlightBlock(block);
                    });
                }else{
                    setTimeout(function(){
                        render();
                    }, 100);
                }
            }
            setTimeout(function(){
                render();
            }, 100);
        }else{
            document.getElementById('contenuMain').innerHTML = response;
            let allScripts = document.getElementById('contenuMain').getElementsByTagName('script');
            for(let script of allScripts){
                if(script.innerHTML == ''){
                    let number = document.getElementsByTagName('script').length;
                    let newScript = document.createElement('script');
                    document.getElementsByTagName('script')[number-1].after(newScript);
                    newScript.src = script.src;
                }else{
                    eval(script.innerHTML);
                }
            }
            let allStyle = document.getElementById('contenuMain').getElementsByTagName('style');
            for(let oneStyle of allStyle){
                if(oneStyle.innerHTML == ''){
                    let number = document.getElementsByTagName('style').length;
                    let newStyle = document.createElement('link');
                    document.getElementsByTagName('style')[number-1].after(newStyle);
                    newStyle.rel= "stylesheet";
                    let re = /src=".*"/;
                    let lien = oneStyle.outerHTML.match(re)[0];
                    lien = lien.substring(5, lien.length-1)
                    newStyle.href = lien;
                    
                }else{
                    //good ?
                }
            }
        }
    }).catch(function (error){
        console.log('log: ', error);
    });
}
const nav =  document.getElementsByTagName('nav');
const allLinks = nav[0].getElementsByTagName('a');
for(let element of allLinks){
    element.addEventListener('click', function () {
            const link = this.getAttribute('href');
            const newPath = window.location.origin + window.location.pathname + '?' + link;
            this.setAttribute('href', newPath);
        });
}
</script>
</body>